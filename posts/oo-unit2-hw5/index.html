<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>OO-Unit2-HW1 | coder0xe's blog</title><meta name=keywords content="OO-UNIT2-HW1"><meta name=description content="OO第二单元第一次作业"><meta name=author content="sudo"><link rel=canonical href=https://coder0xe.github.io/posts/oo-unit2-hw5/><link crossorigin=anonymous href=/assets/css/stylesheet.e4a36188e2c44563c1cc5ed1a2d0b8451a4f68c685114d738b97609f82dae050.css integrity="sha256-5KNhiOLERWPBzF7RotC4RRpPaMaFEU1zi5dgn4La4FA=" rel="preload stylesheet" as=style><link rel=icon href=https://coder0xe.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://coder0xe.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://coder0xe.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://coder0xe.github.io/apple-touch-icon.png><link rel=mask-icon href=https://coder0xe.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://coder0xe.github.io/posts/oo-unit2-hw5/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://coder0xe.github.io/posts/oo-unit2-hw5/"><meta property="og:site_name" content="coder0xe's blog"><meta property="og:title" content="OO-Unit2-HW1"><meta property="og:description" content="OO第二单元第一次作业"><meta property="og:locale" content="zh-CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-25T23:03:42+08:00"><meta property="article:modified_time" content="2024-03-25T23:03:42+08:00"><meta property="article:tag" content="Mar"><meta name=twitter:card content="summary"><meta name=twitter:title content="OO-Unit2-HW1"><meta name=twitter:description content="OO第二单元第一次作业"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://coder0xe.github.io/posts/"},{"@type":"ListItem","position":2,"name":"OO-Unit2-HW1","item":"https://coder0xe.github.io/posts/oo-unit2-hw5/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"OO-Unit2-HW1","name":"OO-Unit2-HW1","description":"OO第二单元第一次作业","keywords":["OO-UNIT2-HW1"],"articleBody":"OO第二单元第一次作业 [toc]\n0. 前置知识 0.1 进程与线程 计算机中，我们把一个任务称作一个进程(Process)\n在一个进程中，还包含一个至多个子任务，称为线程(Thread)\n进程与线程是包含关系，一个进程中可以包含多个线程\n线程内执行顺序确定，线程间执行顺序由操作系统调度，无法确定\ntips:此单元作业中不要使用调试，会影响线程，转为使用打印调试法\n0.1.1 创建新线程 Java语言中内置了多线程支持，当Java程序启动的时候，实际上是启动了一个JVM进程，然后JVM启动主线程来执行main方法，在main方法中我们可以启动其他线程\n继承Thread类\n从Thread类派生一个自定义类，覆写run方法\npublic class myThread extends Thread { @Override public void run() { // ... } } 实现Runnable接口\n实现Runnable接口，重写run方法\npublic class myRunnable implements Runnable { @Override public void run() { //... } } 创建一个新线程\nThread t = new myThread(); Thread t = new Thread(new myRunnable) 启动新线程\nt.start() 注：start()方法会在内部自动调用实例的run方法，直接调用run()方法不会创建新线程 线程入口run()方法的模版\npublic void run(){ try{ while(true){ if(has new task) { //... } else { break; } } //do something to finish } catch(InterruptedException e){ //该线程被调用interrupt //... } //do something to finish } 0.1.2 线程的状态 在Java程序中，一个线程对象只能调用一次start()方法启动新线程，并在新线程中执行run()方法，一旦run()方法执行结束，线程就结束了\nNew:新创建的线程，尚未执行\nRunnable：需要注意的是Runnable对应着两种状态\nReady：准备被调度（尚未运行） Running：正运行 Blocked：运行中的线程，因为某些操作被阻塞而挂起\nWaiting：运行中的线程，不定长时间的等待状态\nTimed Waiting：运行中的线程，定长时间的等待状态（Thread.sleep(),其中sleep传入的参数为毫秒） Terminated：线程终止：run()执行结束或stop()被调用\njoin 当线程对象调用.join方法时，主线程(main)会等待该线程执行结束后才继续往下执行自身线程 0.1.3 中断线程 中断线程就是其他线程给该线程发一个信号，该线程收到信号后结束执行run()方法，自身线程立刻结束运行\nt.interrupt() interrupt()为发送中断请求，不一定能够及时响应\n代码模版如下\nclass myThread extends Thread { public void run() { while (!isInterrupted()) { try { //... } catch (InterruptedException e) { break; } } } } 或者通过设置running标志位来标识线程是否应该继续运行\nclass myThread extends Thread { public volatile boolean running = true; public void run() { while (running) { //... } } } 外部中断线程运行\nt.running = false volatile用于修饰线程间共享的变量，确保每个线程都能读到更新后的变量\n在JAVA虚拟机中，变量的值保存在主内存中，当线程访问变量时，会先获取一个副本，并保存在自己的工作内存中，若线程修改了变量的值，虚拟机会在某个时刻将修改后的值写回到主内存，但是时间不确定！\n这导致了某个线程更新了变量，另一个线程读取的值可能还是更新前的\nvolatile:\n每次访问线程间共享的变量时，总是获取主存内的最新值 每次修改变量后，立即写回到主存 0.1.4 线程同步 多进程之间的共享数据在多进程同时进行读写时，会出现数据不一致的问题\n在多线程模型下，要保证逻辑正确，对共享变量进行读写时，必须保证一组指令以原子方式执行：即某一个线程执行时，其余线程必须等待\n通过加锁和解锁的操作，就能保证这些指令总是在一个线程执行期间，不会有其他线程进入此指令区间，即使在执行期间线程被操作系统中断，其他线程也会因为无法获得锁导致无法进入指令区间。\n加锁和解锁之间的代码块称为临界区，任何时候临界区最多只有一个线程可以执行\n加锁关键字synchronized\n对某一个对象加锁\nsynchronized(obj) { ... } 对某一个方法加锁\nsynchronized method (...) { ... } 对于静态方法: monitor实际是***.class one thread per class 对于动态方法:monitor实际上是this one thread per object/instance 完成工作后就会交出锁，下一个线程拿到锁继续工作\nJava中的synchronized锁是可重入锁\npublic class Counter { private int count = 0; public synchronized void add(int n) { dec(-n); } public synchronized void dec(int n) { count += n; } } java允许线程反复获取同一个锁，例如上例中add和dec方法都需要获取当前实例的this锁，add方法中已经获取了this锁，可以再次获取this锁调用dec\n关于可重入锁：获取锁的时候，不但要判断是否为第一次获取，还要记录这是第几次获取，获取一次锁，记录+1，退出synchronized块，记录-1，减到0的时候会释放锁\n死锁：多个线程各自持有不同的锁，然后各自试图获取对方手中的锁，双方无限等待下去，造成死锁\n解决方法是线程之间获取锁的顺序要一致 0.1.5 wait \u0026\u0026 notify 在synchronized内部可以调用wait()使线程进入等待状态\n必须在已获得的锁对象上调用wait()方法，例如\nthis.wait() 线程进入等待状态后会释放锁，交给其他进程\n在synchronized内部可以调用notify()或notifyAll()唤醒其他等待进程\n通常使用notifyAll更加安全，确保所有访问者的公平性 必须在已获得的锁对象上调用notify()方法\nthis.notify() 被唤醒的线程还需要重新获得锁后才能继续执行\nwait-notify实际上是生产者-消费者模型\n0.2 生产者-消费者模型 生产者向托盘对象中存入生产的货物(synchronized method) 消费者从托盘中取走相应的货物(synchronizedd method) 货物放置控制 货物提取控制 托盘既可以是单一对象，也可以是容器对象 0.3 电梯调度算法 选用LOOK算法，后续详细介绍 1.题目需求分析 完成乘客请求：\n电梯上下行 开关门动作 控制乘客进出电梯 电梯运行基本约束\n可到达楼层1-11 初始位置1层 数量6部(编号为1-6) 移动一层花费的的时间:0.4s 开/关门花费的时间:0.2s 乘客进出电梯不花费时间 限乘人数:6人 乘客只能进入和离开输入时指定的电梯，不可以进入其他电梯(后续作业有变动)\n时间戳]乘客ID-FROM-起点层-TO-终点层-BY-电梯ID 关于性能：\n运行时间尽量短 尽量不让请求等待过长时间 减少系统的无效运行 2.处理流程分析 2.1 多线程协作分析 ​\t在第五次作业中，提供的乘客请求均已指定了接收的电梯，所以我在这一次作业中并没有设计调度器(偷懒)，这导致在第六次作业中需要小小地重构一下构建调度器。第一次接触多线程编程，正所谓谋定而后动，第一重要的是梳理好各个线程之间的协作关系。在第五次作业中，主要涉及到的线程为输入线程和六个电梯线程，为每个电梯设计一个等待队列，每部电梯的等待队列即为该电梯线程与输入线程的共享变量，输入线程将拿到的请求放到队列中，电梯线程从队列中拿出请求，即输入线程为生产者，电梯线程为消费者，这里选择将等待队列类实现为一个线程安全类，即为外部提供好对等待队列的操作接口，外部调用时不必考虑线程安全问题，在类内部保证线程安全问题。这里对线程之间协作的分析如下图：\nUML协作图 主类负责启动各个线程，线程之间的共享变量写到构造方法中\n电梯类向策略类询问接乘客的策略\n这里需要注意的一点是：什么时候设置电梯线程结束？\n当读入的请求为空时，就能说明已经没有后续请求\n在请求队列中设置了标记位endFlag，当读入空请求时将每个电梯中请求队列的标记位置true\n策略类返回OVER建议结束电梯线程：当前电梯中没有人并且请求队列标记位为true\n2.2 电梯调度算法 2.2.1 LOOK算法 这里采用了hyggge学长博客中推荐的LOOK算法，该算法可表述如下(转载)\n首先为电梯规定一个初始方向，然后电梯开始沿着该方向运动。\n到达某楼层时，\n首先判断是否需要开门\n如果发现电梯里有人可以出电梯（到达目的地），则开门让乘客出去； 如果发现该楼层中有人想上电梯，并且目的地方向和电梯方向相同，则开门让这个乘客进入。 接下来，进一步判断电梯里是否有人\n。如果电梯里还有人，则沿着当前方向移动到下一层。否则，检查请求队列中是否还有请求（目前其他楼层是否有乘客想要进电梯）\n如果请求队列不为空，且某请求的发出地是电梯\"前方\"的某楼层，则电梯继续沿着原来的方向运动。\n如果请求队列不为空，且所有请求的发出地都在电梯\"后方\"的楼层上，或者是在该楼层有请求但是这个请求的目的地在电梯后方（因为电梯不会开门接反方向的请求），则电梯掉头并进入\"判断是否需要开门\"的步骤（循环实现）。\n如果请求队列为空，且输入线程没有结束（即没有输入文件结束符），则电梯停在该楼层等待请求输入（wait）。\n注意：电梯等待时运行方向不变。在我的设计中，运行方向是电梯的一个状态量而不是过程量，用来表示下一次move时的方向。当有新请求进入请求队列时，电梯被唤醒，此时电梯的运行方向仍然是电梯wait前的方向。\n如果请求队列为空，且输入线程已经结束，则电梯线程结束。\n2.2.2 电梯类以及策略类的设置 2.2.2.1 Elevator extends Thread 记录电梯运行的基本信息，内聚属于每一部电梯的strategy\n1 2 3 4 5 6 7 private final int elevatorId; // 电梯序号 1-6 private int curNum = 0; // 乘客人数 \u003c=6 private int curFloor = 1; //当前楼层 1-11 private boolean direction = true; // 当前运行方向 private HashMap\u003cInteger, HashSet\u003cPerson\u003e\u003e destMap; private RequestTable requestTable; private Strategy strategy; // 每部电梯的策略 关于deskmap：是\u003c到达楼层(目的地),乘客\u003e的哈希表，在进入乘客时，从请求队列requestTable中删除乘客并加入destmap，出电梯时从destmap中判断(或者说destmap中的人数等于curNum)，这里为了避免后续加入乘客时调用destMap.get(toFloor)可能为空的情况，可以考虑对这个比较复杂的数据结构进行初始化，私有方法destMapInit\n1 2 3 4 5 6 public void destMapinit() { this.destMap = new HashMap\u003c\u003e(); for (int i = 1;i \u003c= 11;i++) { this.destMap.put(i,new HashSet\u003c\u003e()); } } 电梯在每次运行时询问策略类建议，依据对应的策略运行\n@Override public void run() { while (true) { Advice advice = strategy.getAdvice(this.elevatorId,this.curFloor, this.curNum,this.direction,this.destMap); if (advice == Advice.OVER) { break; } else if (advice == Advice.MOVE) { move(); } else if (advice == Advice.REVERSE) { this.direction = !this.direction; } else if (advice == Advice.WAIT) { requestTable.waitRequest(); } else if (advice == Advice.OPEN) { openAndClose(); } } } 返回OVER建议时break，跳出while循环，结束进程 关于电梯等待\n当电梯中请求队列为空且并没有结束请求时等待 当电梯等待列表中新增乘客或设置结束位时通知电梯，不用再等了(由于这里只有两个线程共享requestTable变量，或者说线程池中等待的只有一个线程，调用notify()或notifyAll()效果是相同的) 其他电梯运行方法：运行时间通过Thread.sleep(time)进行模拟实现\n移动\n1 2 3 4 5 6 7 8 9 private void move() { // 移动一层时间为0.4s try { Thread.sleep(400); } catch (InterruptedException e) { e.printStackTrace(); } this.curFloor += this.direction ? 1 : -1; TimableOutput.println(String.format(\"ARRIVE-%d-%d\",this.curFloor,this.elevatorId)); } 进入乘客\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 private void in() { if (this.curNum == 6) { return; } ArrayList\u003cPerson\u003e people = this.requestTable.getRequestMap().get(this.curFloor); for (int i = 0; i \u003c people.size();i++) { Person person = people.get(i); int toFloor = person.getToFloor(); if (this.curNum == 6) { break; } if ((toFloor \u003e this.curFloor \u0026\u0026 this.direction) || (toFloor \u003c this.curFloor \u0026\u0026 !this.direction)) { //乘客从requestTable中转移到destMap } } } 进入乘客时要每一次都判断是否超载 对于等待队列中ArrayList遍历删除的细节：如果采用正序遍历，则每次删除需要将i回退一位，否则可能有遗漏，更优雅的方式是逆序删除 出乘客\n1 2 3 4 private void out() { HashSet\u003cPerson\u003e people = this.destMap.get(this.curFloor); // 用迭代器在目的地在当前楼层的乘客进行遍历删除 } 2.2.2.2 Strategy 对于策略类的实现只需要描述出LOOK算法的内容即可\n对于策略类中返回的建议使用枚举类Advice封装\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 public Advice getAdvice(int elevatorId,int curFloor, int curNum, boolean direction, HashMap\u003cInteger, HashSet\u003cPerson\u003e\u003e destMap) { if (canOpenForout(curFloor, destMap) || canOpenForIn(curFloor, curNum, direction)) { return Advice.OPEN; } if (curNum != 0) { return Advice.MOVE; } else { if (requestTable.isEmpty()) { // 队列为空 if (requestTable.isOver()) { // 输入结束 return Advice.OVER; } else { return Advice.WAIT; } } else { if (hasReqInOriginDirection(curFloor, direction)) { return Advice.MOVE; } else { return Advice.REVERSE; } } } } hasReqInOriginDirection：在电梯当前运行同方向上还有乘客请求 2.2.2.3 RequestTable线程安全类的实现 类中主要共享变量\n// \u003c楼层序号,每个楼层发出请求的人\u003e private HashMap","wordCount":"749","inLanguage":"en","datePublished":"2024-03-25T23:03:42+08:00","dateModified":"2024-03-25T23:03:42+08:00","author":{"@type":"Person","name":"sudo"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://coder0xe.github.io/posts/oo-unit2-hw5/"},"publisher":{"@type":"Organization","name":"coder0xe's blog","logo":{"@type":"ImageObject","url":"https://coder0xe.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://coder0xe.github.io/ accesskey=h title="coder0xe's blog (Alt + H)">coder0xe's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://coder0xe.github.io/ title=首页><span>首页</span></a></li><li><a href=https://coder0xe.github.io/categories/ title=分类><span>分类</span></a></li><li><a href=https://coder0xe.github.io/tags/ title=标签><span>标签</span></a></li><li><a href=https://coder0xe.github.io/archives/ title=归档><span>归档</span></a></li><li><a href=https://coder0xe.github.io/search/ title=搜索><span>搜索</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://coder0xe.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://coder0xe.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">OO-Unit2-HW1</h1><div class=post-description>OO第二单元第一次作业</div><div class=post-meta><span title='2024-03-25 23:03:42 +0800 +0800'>March 25, 2024</span>&nbsp;·&nbsp;<span>4 min</span>&nbsp;·&nbsp;<span>sudo</span></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#oo%e7%ac%ac%e4%ba%8c%e5%8d%95%e5%85%83%e7%ac%ac%e4%b8%80%e6%ac%a1%e4%bd%9c%e4%b8%9a aria-label=OO第二单元第一次作业>OO第二单元第一次作业</a><ul><li><a href=#0-%e5%89%8d%e7%bd%ae%e7%9f%a5%e8%af%86 aria-label="0. 前置知识">0. 前置知识</a><ul><li><a href=#01-%e8%bf%9b%e7%a8%8b%e4%b8%8e%e7%ba%bf%e7%a8%8b aria-label="0.1 进程与线程">0.1 进程与线程</a><ul><li><a href=#011-%e5%88%9b%e5%bb%ba%e6%96%b0%e7%ba%bf%e7%a8%8b aria-label="0.1.1 创建新线程">0.1.1 创建新线程</a></li><li><a href=#012-%e7%ba%bf%e7%a8%8b%e7%9a%84%e7%8a%b6%e6%80%81 aria-label="0.1.2 线程的状态">0.1.2 线程的状态</a></li><li><a href=#013-%e4%b8%ad%e6%96%ad%e7%ba%bf%e7%a8%8b aria-label="0.1.3 中断线程">0.1.3 中断线程</a></li><li><a href=#014-%e7%ba%bf%e7%a8%8b%e5%90%8c%e6%ad%a5 aria-label="0.1.4 线程同步">0.1.4 线程同步</a></li><li><a href=#015-wait--notify aria-label="0.1.5 wait && notify">0.1.5 wait && notify</a></li></ul></li><li><a href=#02-%e7%94%9f%e4%ba%a7%e8%80%85-%e6%b6%88%e8%b4%b9%e8%80%85%e6%a8%a1%e5%9e%8b aria-label="0.2 生产者-消费者模型">0.2 生产者-消费者模型</a></li><li><a href=#03-%e7%94%b5%e6%a2%af%e8%b0%83%e5%ba%a6%e7%ae%97%e6%b3%95 aria-label="0.3 电梯调度算法">0.3 电梯调度算法</a></li></ul></li><li><a href=#1%e9%a2%98%e7%9b%ae%e9%9c%80%e6%b1%82%e5%88%86%e6%9e%90 aria-label=1.题目需求分析>1.题目需求分析</a></li><li><a href=#2%e5%a4%84%e7%90%86%e6%b5%81%e7%a8%8b%e5%88%86%e6%9e%90 aria-label=2.处理流程分析>2.处理流程分析</a><ul><li><a href=#21-%e5%a4%9a%e7%ba%bf%e7%a8%8b%e5%8d%8f%e4%bd%9c%e5%88%86%e6%9e%90 aria-label="2.1 多线程协作分析">2.1 多线程协作分析</a><ul><li><a href=#uml%e5%8d%8f%e4%bd%9c%e5%9b%be aria-label=UML协作图>UML协作图</a></li></ul></li><li><a href=#22-%e7%94%b5%e6%a2%af%e8%b0%83%e5%ba%a6%e7%ae%97%e6%b3%95 aria-label="2.2 电梯调度算法">2.2 电梯调度算法</a><ul><li><a href=#221-look%e7%ae%97%e6%b3%95 aria-label="2.2.1 LOOK算法">2.2.1 LOOK算法</a></li><li><a href=#222-%e7%94%b5%e6%a2%af%e7%b1%bb%e4%bb%a5%e5%8f%8a%e7%ad%96%e7%95%a5%e7%b1%bb%e7%9a%84%e8%ae%be%e7%bd%ae aria-label="2.2.2 电梯类以及策略类的设置">2.2.2 电梯类以及策略类的设置</a><ul><li><a href=#2221-elevator-extends-thread aria-label="2.2.2.1 Elevator extends Thread">2.2.2.1 Elevator extends Thread</a></li><li><a href=#2222-strategy aria-label="2.2.2.2 Strategy">2.2.2.2 Strategy</a></li><li><a href=#2223-requesttable%e7%ba%bf%e7%a8%8b%e5%ae%89%e5%85%a8%e7%b1%bb%e7%9a%84%e5%ae%9e%e7%8e%b0 aria-label="2.2.2.3 RequestTable线程安全类的实现">2.2.2.3 RequestTable线程安全类的实现</a></li></ul></li></ul></li></ul></li><li><a href=#3-uml%e7%b1%bb%e5%9b%be%e4%bb%a5%e5%8f%8a%e4%bb%a3%e7%a0%81%e5%a4%8d%e6%9d%82%e5%ba%a6%e5%88%86%e6%9e%90 aria-label="3. UML类图以及代码复杂度分析">3. UML类图以及代码复杂度分析</a><ul><ul><li><a href=#31-uml%e7%b1%bb%e5%9b%be aria-label="3.1 UML类图">3.1 UML类图</a></li><li><a href=#32-%e4%bb%a3%e7%a0%81%e5%a4%8d%e6%9d%82%e5%ba%a6%e5%88%86%e6%9e%90 aria-label="3.2 代码复杂度分析">3.2 代码复杂度分析</a></li></ul></ul></li><li><a href=#4-bug%e4%bf%ae%e5%a4%8d%e4%b8%8e%e7%ad%96%e7%95%a5 aria-label="4. Bug修复与策略">4. Bug修复与策略</a></li></ul></li></ul></div></details></div><div class=post-content><h1 id=oo第二单元第一次作业>OO第二单元第一次作业<a hidden class=anchor aria-hidden=true href=#oo第二单元第一次作业>#</a></h1><p>[toc]</p><h2 id=0-前置知识>0. 前置知识<a hidden class=anchor aria-hidden=true href=#0-前置知识>#</a></h2><h3 id=01-进程与线程>0.1 进程与线程<a hidden class=anchor aria-hidden=true href=#01-进程与线程>#</a></h3><ul><li><p>计算机中，我们把一个任务称作一个进程(Process)</p></li><li><p>在一个进程中，还包含一个至多个子任务，称为线程(Thread)</p></li><li><p>进程与线程是包含关系，一个进程中可以包含多个线程</p></li><li><p>线程内执行顺序确定，线程间执行顺序由操作系统调度，无法确定</p></li><li><p><strong>tips:此单元作业中不要使用调试，会影响线程，转为使用打印调试法</strong></p></li></ul><p><img alt=image-20240326000818799 loading=lazy src=/img/image-20240326000818799.png></p><h4 id=011-创建新线程>0.1.1 创建新线程<a hidden class=anchor aria-hidden=true href=#011-创建新线程>#</a></h4><ul><li><p>Java语言中内置了多线程支持，当Java程序启动的时候，实际上是启动了一个<strong>JVM进程</strong>，然后JVM启动<strong>主线程</strong>来执行<code>main</code>方法，在<code>main</code>方法中我们可以<strong>启动其他线程</strong></p></li><li><p><strong>继承Thread类</strong></p><p><strong>从Thread类派生一个自定义类，覆写run方法</strong></p><pre tabindex=0><code>public class myThread extends Thread {
	@Override
	public void run() {
		// ...
	}
}
</code></pre></li><li><p><strong>实现Runnable接口</strong></p><p><strong>实现Runnable接口，重写run方法</strong></p><pre tabindex=0><code>public class myRunnable implements Runnable {
	@Override 
	public void run() {
		//...
	}
}
</code></pre></li><li><p><strong>创建一个新线程</strong></p><pre tabindex=0><code>Thread t = new myThread();
Thread t = new Thread(new myRunnable)
</code></pre></li><li><p><strong>启动新线程</strong></p><pre tabindex=0><code>t.start()
</code></pre><ul><li><strong>注：start()方法会在内部自动调用实例的run方法，直接调用run()方法不会创建新线程</strong></li></ul></li><li><p>线程入口<code>run()</code>方法的模版</p><pre tabindex=0><code>public void run(){
	try{
		while(true){
			if(has new task) {
				//...
			} else {
				break;
			}
		}
		//do something to finish
	}
	catch(InterruptedException e){  //该线程被调用interrupt
		//...
	}
	//do something to finish
}
</code></pre></li></ul><h4 id=012-线程的状态>0.1.2 线程的状态<a hidden class=anchor aria-hidden=true href=#012-线程的状态>#</a></h4><blockquote><p>在Java程序中，一个线程对象只能调用一次start()方法启动新线程，并在新线程中执行run()方法，一旦run()方法执行结束，线程就结束了</p></blockquote><ul><li><p><strong>New</strong>:新创建的线程，尚未执行</p></li><li><p><strong>Runnable</strong>：<strong>需要注意的是Runnable对应着两种状态</strong></p><ul><li><strong>Ready</strong>：准备被调度（尚未运行）</li><li><strong>Running</strong>：正运行</li></ul></li><li><p><strong>Blocked</strong>：运行中的线程，因为某些操作被阻塞而挂起</p></li><li><p><strong>Waiting</strong>：运行中的线程，不定长时间的等待状态</p><ul><li><strong>Timed Waiting</strong>：运行中的线程，定长时间的等待状态（<code>Thread.sleep()</code>,其中sleep传入的参数为毫秒）</li></ul></li><li><p><strong>Terminated</strong>：线程终止：run()执行结束或stop()被调用</p></li></ul><p><img alt=image-20240326003802096 loading=lazy src=/img/image-20240326003802096.png></p><ul><li><strong>join</strong><ul><li>当线程对象调用<code>.join</code>方法时，主线程(main)会等待该线程执行结束后才继续往下执行自身线程</li></ul></li></ul><h4 id=013-中断线程>0.1.3 中断线程<a hidden class=anchor aria-hidden=true href=#013-中断线程>#</a></h4><ul><li><p>中断线程就是其他线程给该线程发一个信号，该线程收到信号后结束执行<code>run()</code>方法，自身线程立刻结束运行</p><pre tabindex=0><code>t.interrupt()
</code></pre></li><li><p><strong>interrupt()为发送中断请求，不一定能够及时响应</strong></p></li><li><p>代码模版如下</p><pre tabindex=0><code>class myThread extends Thread {
    public void run() {
        while (!isInterrupted()) {
            try {
                //...
            } catch (InterruptedException e) {
                break;
            }
        }
    }
}
</code></pre></li><li><p><strong>或者通过设置running标志位来标识线程是否应该继续运行</strong></p><pre tabindex=0><code>class myThread extends Thread {
    public volatile boolean running = true;
    public void run() {
        while (running) {
            //...
        }
    }
}
</code></pre><ul><li><p>外部中断线程运行</p><pre tabindex=0><code>t.running = false
</code></pre></li><li><p><code>volatile</code>用于修饰线程间共享的变量，确保每个线程都能读到更新后的变量</p><p><strong>在JAVA虚拟机中，变量的值保存在主内存中，当线程访问变量时，会先获取一个副本，并保存在自己的工作内存中，若线程修改了变量的值，虚拟机会在某个时刻将修改后的值写回到主内存，但是时间不确定！</strong></p><p><img alt=image-20240326010932959 loading=lazy src=/img/image-20240326010932959.png></p><p><strong>这导致了某个线程更新了变量，另一个线程读取的值可能还是更新前的</strong></p><p>volatile:</p><ul><li>每次访问线程间共享的变量时，总是获取主存内的最新值</li><li>每次修改变量后，立即写回到主存</li></ul></li></ul></li></ul><h4 id=014-线程同步>0.1.4 线程同步<a hidden class=anchor aria-hidden=true href=#014-线程同步>#</a></h4><ul><li><p>多进程之间的共享数据在多进程同时进行读写时，会出现数据不一致的问题</p><p><img alt=image-20240326143506047 loading=lazy src=/img/image-20240326143506047.png></p></li><li><p><strong>在多线程模型下，要保证逻辑正确，对共享变量进行读写时，必须保证一组指令以原子方式执行：即某一个线程执行时，其余线程必须等待</strong></p><p><img alt=image-20240326143514746 loading=lazy src=/img/image-20240326143514746.png></p></li><li><p>通过<strong>加锁和解锁</strong>的操作，就能保证这些指令总是在一个线程执行期间，不会有其他线程进入此指令区间，即使在执行期间线程被操作系统中断，其他线程也会因为无法获得锁导致无法进入指令区间。</p></li><li><p><strong>加锁和解锁之间的代码块称为临界区，任何时候临界区最多只有一个线程可以执行</strong></p></li><li><p>加锁关键字<code>synchronized</code></p></li><li><p><strong>对某一个对象加锁</strong></p><pre tabindex=0><code>synchronized(obj) {
	...
}
</code></pre></li><li><p><strong>对某一个方法加锁</strong></p><pre tabindex=0><code>synchronized method (...) {
	...
}
</code></pre><ul><li>对于静态方法: monitor实际是***.class<ul><li>one thread per class</li></ul></li><li><strong>对于动态方法:monitor实际上是this</strong><ul><li>one thread per object/instance</li></ul></li></ul></li><li><p>完成工作后就会交出锁，下一个线程拿到锁继续工作</p></li><li><p>Java中的<code>synchronized</code>锁是可重入锁</p><pre tabindex=0><code>public class Counter {
    private int count = 0;
    public synchronized void add(int n) {     
       dec(-n);
    }

    public synchronized void dec(int n) {
        count += n;
    }
}
</code></pre><p><strong>java允许线程反复获取同一个锁，例如上例中add和dec方法都需要获取当前实例的this锁，add方法中已经获取了this锁，可以再次获取this锁调用dec</strong></p></li><li><p>关于可重入锁：获取锁的时候，不但要判断是否为第一次获取，还要记录这是第几次获取，获取一次锁，记录+1，退出synchronized块，记录-1，减到0的时候会释放锁</p></li><li><p>死锁：多个线程各自持有不同的锁，然后各自试图获取对方手中的锁，双方无限等待下去，造成死锁</p><ul><li><strong>解决方法是线程之间获取锁的顺序要一致</strong></li></ul></li></ul><h4 id=015-wait--notify>0.1.5 wait && notify<a hidden class=anchor aria-hidden=true href=#015-wait--notify>#</a></h4><ul><li><p>在<code>synchronized</code>内部可以调用<code>wait()</code>使线程进入等待状态</p></li><li><p>必须在已获得的锁对象上调用<code>wait()</code>方法，例如</p><pre tabindex=0><code>this.wait()
</code></pre></li><li><p>线程进入等待状态后会释放锁，交给其他进程</p></li><li><p>在<code>synchronized</code>内部可以调用<code>notify()</code>或<code>notifyAll()</code>唤醒其他等待进程</p><ul><li>通常使用<code>notifyAll</code>更加安全，确保所有访问者的公平性</li></ul></li><li><p>必须在已获得的锁对象上调用<code>notify()</code>方法</p><pre tabindex=0><code>this.notify()
</code></pre></li><li><p>被唤醒的线程还需要重新获得锁后才能继续执行</p></li><li><p>wait-notify实际上是生产者-消费者模型</p></li></ul><h3 id=02-生产者-消费者模型>0.2 生产者-消费者模型<a hidden class=anchor aria-hidden=true href=#02-生产者-消费者模型>#</a></h3><ul><li>生产者向<strong>托盘对象</strong>中存入生产的货物(<code>synchronized method</code>)</li><li>消费者从<strong>托盘</strong>中取走相应的货物(<code>synchronizedd method</code>)</li><li>货物放置控制</li><li>货物提取控制</li><li>托盘既可以是单一对象，<strong>也可以是容器对象</strong></li></ul><h3 id=03-电梯调度算法>0.3 电梯调度算法<a hidden class=anchor aria-hidden=true href=#03-电梯调度算法>#</a></h3><ul><li>选用LOOK算法，后续详细介绍</li></ul><h2 id=1题目需求分析>1.题目需求分析<a hidden class=anchor aria-hidden=true href=#1题目需求分析>#</a></h2><ul><li><p>完成乘客请求：</p><ul><li>电梯上下行</li><li>开关门动作</li><li>控制乘客进出电梯</li></ul></li><li><p>电梯运行基本约束</p><ul><li>可到达楼层1-11</li><li>初始位置1层</li><li>数量6部(编号为1-6)</li><li>移动一层花费的的时间:0.4s</li><li>开/关门花费的时间:0.2s</li><li>乘客进出电梯不花费时间</li><li>限乘人数:6人</li></ul></li><li><p><strong>乘客只能进入和离开输入时指定的电梯，不可以进入其他电梯</strong>(后续作业有变动)</p><pre tabindex=0><code>时间戳]乘客ID-FROM-起点层-TO-终点层-BY-电梯ID
</code></pre></li><li><p>关于性能：</p><ul><li>运行时间尽量短</li><li>尽量不让请求等待过长时间</li><li>减少系统的无效运行</li></ul></li></ul><h2 id=2处理流程分析>2.处理流程分析<a hidden class=anchor aria-hidden=true href=#2处理流程分析>#</a></h2><h3 id=21-多线程协作分析>2.1 多线程协作分析<a hidden class=anchor aria-hidden=true href=#21-多线程协作分析>#</a></h3><p>​ 在第五次作业中，提供的乘客请求均已指定了接收的电梯，所以我在这一次作业中<strong>并没有设计调度器</strong>(<del>偷懒</del>)，这导致在第六次作业中需要小小地重构一下构建调度器。第一次接触多线程编程，正所谓谋定而后动，第一重要的是梳理好各个线程之间的协作关系。在第五次作业中，主要涉及到的线程为输入线程和六个电梯线程，为每个电梯设计一个等待队列，<strong>每部电梯的等待队列即为该电梯线程与输入线程的共享变量，输入线程将拿到的请求放到队列中，电梯线程从队列中拿出请求，即输入线程为生产者，电梯线程为消费者</strong>，这里选择将等待队列类实现为一个<strong>线程安全类</strong>，即为外部提供好对等待队列的操作接口，外部调用时不必考虑线程安全问题，在类内部保证线程安全问题。这里对线程之间协作的分析如下图：</p><h4 id=uml协作图>UML协作图<a hidden class=anchor aria-hidden=true href=#uml协作图>#</a></h4><p><img alt=image-20240420001259585 loading=lazy src=/img/image-20240420001259585.png></p><ul><li><p>主类负责启动各个线程，线程之间的共享变量写到构造方法中</p></li><li><p>电梯类向策略类询问接乘客的策略</p></li><li><p>这里需要注意的一点是：<strong>什么时候设置电梯线程结束？</strong></p><ul><li><p>当读入的请求为空时，就能说明已经没有后续请求</p></li><li><p>在请求队列中设置了标记位<code>endFlag</code>，当读入空请求时将每个电梯中请求队列的标记位置<code>true</code></p></li><li><p>策略类返回OVER建议结束电梯线程：当前电梯中没有人并且请求队列标记位为<code>true</code></p></li></ul></li></ul><h3 id=22-电梯调度算法>2.2 电梯调度算法<a hidden class=anchor aria-hidden=true href=#22-电梯调度算法>#</a></h3><h4 id=221-look算法>2.2.1 LOOK算法<a hidden class=anchor aria-hidden=true href=#221-look算法>#</a></h4><blockquote><p>这里采用了hyggge学长博客中推荐的LOOK算法，该算法可表述如下(转载)</p></blockquote><ul><li><p>首先为电梯规定一个初始方向，然后电梯开始沿着该方向运动。</p></li><li><p>到达某楼层时，</p><p>首先判断是否需要开门</p><ul><li>如果发现电梯里有人可以出电梯（到达目的地），则开门让乘客出去；</li><li>如果发现该楼层中有人想上电梯，并且目的地方向和电梯方向相同，则开门让这个乘客进入。</li></ul></li><li><p>接下来，进一步判断电梯里是否有人</p><p>。如果电梯里还有人，则沿着当前方向移动到下一层。否则，检查请求队列中是否还有请求（目前其他楼层是否有乘客想要进电梯）</p><ul><li><p>如果请求队列不为空，且某请求的发出地是电梯"前方"的某楼层，则电梯继续沿着原来的方向运动。</p></li><li><p>如果请求队列不为空，且所有请求的发出地都在电梯"后方"的楼层上，或者是在该楼层有请求但是这个请求的目的地在电梯后方（因为电梯不会开门接反方向的请求），则电梯掉头并进入"判断是否需要开门"的步骤（循环实现）。</p></li><li><p>如果请求队列为空，且输入线程没有结束（即没有输入文件结束符），则电梯停在该楼层等待请求输入（wait）。</p><blockquote><p>注意：电梯等待时运行方向不变。在我的设计中，运行方向是电梯的一个状态量而不是过程量，用来表示<strong>下一次move时的方向</strong>。当有新请求进入请求队列时，电梯被唤醒，此时电梯的运行方向仍然是电梯wait前的方向。</p></blockquote></li><li><p>如果请求队列为空，且输入线程已经结束，则电梯线程结束。</p></li></ul></li></ul><h4 id=222-电梯类以及策略类的设置>2.2.2 电梯类以及策略类的设置<a hidden class=anchor aria-hidden=true href=#222-电梯类以及策略类的设置>#</a></h4><h5 id=2221-elevator-extends-thread>2.2.2.1 Elevator extends Thread<a hidden class=anchor aria-hidden=true href=#2221-elevator-extends-thread>#</a></h5><ul><li><p>记录电梯运行的基本信息，内聚属于每一部电梯的strategy</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd;font-style:italic>final</span> <span style=color:#8be9fd>int</span> elevatorId; <span style=color:#6272a4>// 电梯序号 1-6</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd>int</span> curNum <span style=color:#ff79c6>=</span> 0; <span style=color:#6272a4>// 乘客人数 &lt;=6</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd>int</span> curFloor <span style=color:#ff79c6>=</span> 1; <span style=color:#6272a4>//当前楼层 1-11</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd>boolean</span> direction <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>true</span>; <span style=color:#6272a4>// 当前运行方向</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> HashMap<span style=color:#ff79c6>&lt;</span>Integer, HashSet<span style=color:#ff79c6>&lt;</span>Person<span style=color:#ff79c6>&gt;&gt;</span> destMap;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> RequestTable requestTable;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> Strategy strategy; <span style=color:#6272a4>// 每部电梯的策略</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><p>关于deskmap：<strong>是&lt;到达楼层(目的地),乘客>的哈希表</strong>，在进入乘客时，从请求队列requestTable中删除乘客并加入destmap，出电梯时从destmap中判断(或者说destmap中的人数等于curNum)，这里为了避免后续加入乘客时调用<code>destMap.get(toFloor)</code>可能为空的情况，可以考虑对这个比较复杂的数据结构进行初始化，私有方法<code>destMapInit</code></p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>destMapinit</span>() {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>destMap</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> HashMap<span style=color:#ff79c6>&lt;&gt;</span>();
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> (<span style=color:#8be9fd>int</span> i <span style=color:#ff79c6>=</span> 1;i <span style=color:#ff79c6>&lt;=</span> 11;i<span style=color:#ff79c6>++</span>) {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>destMap</span>.<span style=color:#50fa7b>put</span>(i,<span style=color:#ff79c6>new</span> HashSet<span style=color:#ff79c6>&lt;&gt;</span>());
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></li></ul></li><li><p>电梯在每次运行时询问策略类建议，依据对应的策略运行</p><pre tabindex=0><code>    @Override
    public void run() {
        while (true) {
            Advice advice = strategy.getAdvice(this.elevatorId,this.curFloor,
                    this.curNum,this.direction,this.destMap);
            if (advice == Advice.OVER) {
                break;
            } else if (advice == Advice.MOVE) {
                move();
            } else if (advice == Advice.REVERSE) {
                this.direction = !this.direction;
            } else if (advice == Advice.WAIT) {
                requestTable.waitRequest();
            } else if (advice == Advice.OPEN) {
                openAndClose();
            }
        }
    }
</code></pre><ul><li>返回OVER建议时break，跳出while循环，结束进程</li></ul></li><li><p><strong>关于电梯等待</strong></p><ul><li>当电梯中请求队列为空且并没有结束请求时等待</li><li>当<strong>电梯等待列表中新增乘客或设置结束位时通知电梯</strong>，不用再等了(由于这里只有两个线程共享requestTable变量，或者说线程池中等待的只有一个线程，调用<code>notify()</code>或<code>notifyAll()</code>效果是相同的)</li></ul></li><li><p>其他电梯运行方法：运行时间通过<code>Thread.sleep(time)</code>进行模拟实现</p><ul><li><p>移动</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>move</span>() { <span style=color:#6272a4>// 移动一层时间为0.4s</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>try</span> {
</span></span><span style=display:flex><span>            Thread.<span style=color:#50fa7b>sleep</span>(400);
</span></span><span style=display:flex><span>        } <span style=color:#ff79c6>catch</span> (InterruptedException e) {
</span></span><span style=display:flex><span>            e.<span style=color:#50fa7b>printStackTrace</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>curFloor</span> <span style=color:#ff79c6>+=</span> <span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>direction</span> <span style=color:#ff79c6>?</span> 1 : <span style=color:#ff79c6>-</span>1;
</span></span><span style=display:flex><span>        TimableOutput.<span style=color:#50fa7b>println</span>(String.<span style=color:#50fa7b>format</span>(<span style=color:#f1fa8c>&#34;ARRIVE-%d-%d&#34;</span>,<span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>curFloor</span>,<span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>elevatorId</span>));
</span></span><span style=display:flex><span>    }
</span></span></code></pre></td></tr></table></div></div></li><li><p>进入乘客</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>in</span>() {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>curNum</span> <span style=color:#ff79c6>==</span> 6) {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        ArrayList<span style=color:#ff79c6>&lt;</span>Person<span style=color:#ff79c6>&gt;</span> people <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>requestTable</span>.<span style=color:#50fa7b>getRequestMap</span>().<span style=color:#50fa7b>get</span>(<span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>curFloor</span>);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> (<span style=color:#8be9fd>int</span> i <span style=color:#ff79c6>=</span> 0; i <span style=color:#ff79c6>&lt;</span> people.<span style=color:#50fa7b>size</span>();i<span style=color:#ff79c6>++</span>) {
</span></span><span style=display:flex><span>            Person person <span style=color:#ff79c6>=</span> people.<span style=color:#50fa7b>get</span>(i);
</span></span><span style=display:flex><span>            <span style=color:#8be9fd>int</span> toFloor <span style=color:#ff79c6>=</span> person.<span style=color:#50fa7b>getToFloor</span>();
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>curNum</span> <span style=color:#ff79c6>==</span> 6) {
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>if</span> ((toFloor <span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>curFloor</span> <span style=color:#ff79c6>&amp;&amp;</span> <span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>direction</span>)
</span></span><span style=display:flex><span>                    <span style=color:#ff79c6>||</span> (toFloor <span style=color:#ff79c6>&lt;</span> <span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>curFloor</span> <span style=color:#ff79c6>&amp;&amp;</span> <span style=color:#ff79c6>!</span><span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>direction</span>)) {
</span></span><span style=display:flex><span>                <span style=color:#6272a4>//乘客从requestTable中转移到destMap</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></td></tr></table></div></div><ul><li>进入乘客时要每一次都判断<strong>是否超载</strong></li><li>对于等待队列中ArrayList遍历删除的细节：如果采用正序遍历，则每次删除需要将i回退一位，否则可能有遗漏，<strong>更优雅的方式是逆序删除</strong></li></ul></li><li><p>出乘客</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>out</span>() {
</span></span><span style=display:flex><span>        HashSet<span style=color:#ff79c6>&lt;</span>Person<span style=color:#ff79c6>&gt;</span> people <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>destMap</span>.<span style=color:#50fa7b>get</span>(<span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>curFloor</span>);
</span></span><span style=display:flex><span>      	<span style=color:#6272a4>// 用迭代器在目的地在当前楼层的乘客进行遍历删除</span>
</span></span><span style=display:flex><span>    }
</span></span></code></pre></td></tr></table></div></div></li></ul></li></ul><h5 id=2222-strategy>2.2.2.2 Strategy<a hidden class=anchor aria-hidden=true href=#2222-strategy>#</a></h5><blockquote><p>对于策略类的实现只需要描述出LOOK算法的内容即可</p><p>对于策略类中返回的建议使用枚举类Advice封装</p></blockquote><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-java data-lang=java><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>public</span> Advice <span style=color:#50fa7b>getAdvice</span>(<span style=color:#8be9fd>int</span> elevatorId,<span style=color:#8be9fd>int</span> curFloor, <span style=color:#8be9fd>int</span> curNum, <span style=color:#8be9fd>boolean</span> direction,
</span></span><span style=display:flex><span>                            HashMap<span style=color:#ff79c6>&lt;</span>Integer, HashSet<span style=color:#ff79c6>&lt;</span>Person<span style=color:#ff79c6>&gt;&gt;</span> destMap) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (canOpenForout(curFloor, destMap) <span style=color:#ff79c6>||</span> canOpenForIn(curFloor, curNum, direction)) {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span> Advice.<span style=color:#50fa7b>OPEN</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (curNum <span style=color:#ff79c6>!=</span> 0) {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span> Advice.<span style=color:#50fa7b>MOVE</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>if</span> (requestTable.<span style=color:#50fa7b>isEmpty</span>()) { <span style=color:#6272a4>// 队列为空</span>
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>if</span> (requestTable.<span style=color:#50fa7b>isOver</span>()) { <span style=color:#6272a4>// 输入结束</span>
</span></span><span style=display:flex><span>                    <span style=color:#ff79c6>return</span> Advice.<span style=color:#50fa7b>OVER</span>;
</span></span><span style=display:flex><span>                } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>                    <span style=color:#ff79c6>return</span> Advice.<span style=color:#50fa7b>WAIT</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>if</span> (hasReqInOriginDirection(curFloor, direction)) {
</span></span><span style=display:flex><span>                    <span style=color:#ff79c6>return</span> Advice.<span style=color:#50fa7b>MOVE</span>;
</span></span><span style=display:flex><span>                } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>                    <span style=color:#ff79c6>return</span> Advice.<span style=color:#50fa7b>REVERSE</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></td></tr></table></div></div><ul><li>hasReqInOriginDirection：在电梯当前运行同方向上还有乘客请求</li></ul><h5 id=2223-requesttable线程安全类的实现>2.2.2.3 RequestTable线程安全类的实现<a hidden class=anchor aria-hidden=true href=#2223-requesttable线程安全类的实现>#</a></h5><ul><li><p>类中主要共享变量</p><pre tabindex=0><code>// &lt;楼层序号,每个楼层发出请求的人&gt;
private HashMap&lt;Integer, ArrayList&lt;Person&gt;&gt; requestMap;
// 请求数量
private int requestNum;
// 请求结束标记
private boolean endFlag;
</code></pre></li><li><p>对以上变量的读写要保证线程安全，这里我的实现是对以上变量的读写均设置为<code>synchronized</code>方法，值得一提的是增加请求方法和设置结束标志方法，这两个方法需要对睡着的电梯线程进行唤醒，<strong>电梯等待的原因是此时没有请求且没有结束，这两个方法会对电梯等待的条件判断造成破坏（增加请求/已经结束），这样似乎更好理解需要唤醒电梯的原因</strong></p><ul><li><p>addRequest()</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>synchronized</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>addRequest</span>(Person person) {
</span></span><span style=display:flex><span>        <span style=color:#8be9fd>int</span> fromFloor <span style=color:#ff79c6>=</span> person.<span style=color:#50fa7b>getFromFloor</span>();
</span></span><span style=display:flex><span>        requestMap.<span style=color:#50fa7b>get</span>(fromFloor).<span style=color:#50fa7b>add</span>(person);
</span></span><span style=display:flex><span>        requestNum<span style=color:#ff79c6>++</span>;
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>notify</span>();
</span></span><span style=display:flex><span>    }
</span></span></code></pre></td></tr></table></div></div></li><li><p>setOver()</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>synchronized</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>setOver</span>() {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>notify</span>();
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>endFlag</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>true</span>;
</span></span><span style=display:flex><span>    }
</span></span></code></pre></td></tr></table></div></div></li></ul></li><li><p>其他方法：判断电梯是否为空，是否结束，电梯等待，删除请求等，不一一赘述了</p></li></ul><h2 id=3-uml类图以及代码复杂度分析>3. UML类图以及代码复杂度分析<a hidden class=anchor aria-hidden=true href=#3-uml类图以及代码复杂度分析>#</a></h2><h4 id=31-uml类图>3.1 UML类图<a hidden class=anchor aria-hidden=true href=#31-uml类图>#</a></h4><p><img alt=image-20240420015545703 loading=lazy src=/img/image-20240420015545703.png></p><h4 id=32-代码复杂度分析>3.2 代码复杂度分析<a hidden class=anchor aria-hidden=true href=#32-代码复杂度分析>#</a></h4><p><img alt=image-20240420005952370 loading=lazy src=/img/image-20240420005952370.png></p><ul><li>主要复杂度集中在电梯类中进入乘客和策略类中判断策略的部分，可以理解</li></ul><h2 id=4-bug修复与策略>4. Bug修复与策略<a hidden class=anchor aria-hidden=true href=#4-bug修复与策略>#</a></h2><ul><li>主要的调试方法：输出</li><li>在此次作业中强测和互测均无bug</li><li>互测中房友的bug：本摆烂人交了一发样例刀中了人，没有细究原因(<del>摆烂摊手</del>)</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://coder0xe.github.io/tags/mar/>Mar</a></li></ul><nav class=paginav><a class=prev href=https://coder0xe.github.io/posts/os-lab2%E8%AF%BE%E4%B8%8B%E5%9F%BA%E7%A1%80/><span class=title>« Prev</span><br><span>OS:lab2课下基础</span>
</a><a class=next href=https://coder0xe.github.io/posts/os%E7%AC%AC%E4%BA%8C%E6%AC%A1%E7%90%86%E8%AE%BA%E4%BD%9C%E4%B8%9A/><span class=title>Next »</span><br><span>OS第二次理论作业</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share OO-Unit2-HW1 on x" href="https://x.com/intent/tweet/?text=OO-Unit2-HW1&amp;url=https%3a%2f%2fcoder0xe.github.io%2fposts%2foo-unit2-hw5%2f&amp;hashtags=Mar"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share OO-Unit2-HW1 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fcoder0xe.github.io%2fposts%2foo-unit2-hw5%2f&amp;title=OO-Unit2-HW1&amp;summary=OO-Unit2-HW1&amp;source=https%3a%2f%2fcoder0xe.github.io%2fposts%2foo-unit2-hw5%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share OO-Unit2-HW1 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fcoder0xe.github.io%2fposts%2foo-unit2-hw5%2f&title=OO-Unit2-HW1"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share OO-Unit2-HW1 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fcoder0xe.github.io%2fposts%2foo-unit2-hw5%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share OO-Unit2-HW1 on whatsapp" href="https://api.whatsapp.com/send?text=OO-Unit2-HW1%20-%20https%3a%2f%2fcoder0xe.github.io%2fposts%2foo-unit2-hw5%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share OO-Unit2-HW1 on telegram" href="https://telegram.me/share/url?text=OO-Unit2-HW1&amp;url=https%3a%2f%2fcoder0xe.github.io%2fposts%2foo-unit2-hw5%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share OO-Unit2-HW1 on ycombinator" href="https://news.ycombinator.com/submitlink?t=OO-Unit2-HW1&u=https%3a%2f%2fcoder0xe.github.io%2fposts%2foo-unit2-hw5%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://coder0xe.github.io/>coder0xe's blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>